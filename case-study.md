# Case-study оптимизации

## Актуальная проблема
В нашем проекте возникла серьёзная проблема.

Необходимо было обработать файл с данными, чуть больше ста мегабайт.

У нас уже была программа на `ruby`, которая умела делать нужную обработку.

Она успешно работала на файлах размером пару мегабайт, но для большого файла она работала слишком долго, и не было понятно, закончит ли она вообще работу за какое-то разумное время.

Я решил исправить эту проблему, оптимизировав эту программу.

### Бюджет и метрика
Наша метрика: потребление памяти при работе программы
Наш бюджет: 70MB

### Ваша находка №1
- Профилировали с помощью ruby-prof
- Обнаружена точка роста: необязательный data.parse
- Решение: удалили parse
- Было: Total: 473954.000000
- Стало: Total: 247170.000000

### Ваша находка №2
- Профилировали с помощью ruby-prof
- Обнаружена точка роста: большое количество объектов, создаваемое через map
- Решение: убраны лишние map'ы
- Было: Total: 247170.000000
- Стало: Total: 234184.000000

### Ваша находка №2
- Профилировали гемом `memory_profiler`
- Обнаружена точка роста: большое потребление памяти на File
- Решение: открывать файл только дин раз
- Было: Total allocated: 156.74 MB
- Стало: Total allocated: 72.87 MB

## Checklist
- [X] Построить и проанализировать отчёт гемом `memory_profiler`
- [X] Построить и проанализировать отчёт `ruby-prof` в режиме `Flat`;
- [X] Построить и проанализировать отчёт `ruby-prof` в режиме `Graph`;
- [X] Построить и проанализировать отчёт `ruby-prof` в режиме `CallStack`;
- [ ] Построить и проанализировать отчёт `ruby-prof` в режиме `CallTree` c визуализацией в `QCachegrind`;
- [X] Построить и проанализировать текстовый отчёт `stackprof`;
- [ ] Построить и проанализировать отчёт `flamegraph` с помощью `stackprof` и визуализировать его в `speedscope.app`;
- [X] Построить график потребления памяти в `valgrind massif visualier` и включить скриншот в описание вашего `PR`;
- [X] Написать тест, на то что программа укладывается в бюджет по памяти
